import{u as O,r as i,j as e,v as D,_ as f,A as b,C as R,l as w,a as L,b as S,N as _,c as P,I as B,R as A,d as I,e as M,B as T}from"./vendor-HKqkJYON.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))c(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const u of n.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&c(u)}).observe(document,{childList:!0,subtree:!0});function l(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function c(r){if(r.ep)return;r.ep=!0;const n=l(r);fetch(r.href,n)}})();const H=()=>{const o=O(),[t,l]=i.useState(""),[c,r]=i.useState(""),n=d=>{d.preventDefault();const x=D();l(x),f.success("Created a new room")},u=()=>{if(!t){f.error("Room ID is required");return}if(!c){f.error("Username is required");return}o(`/editor/${t}`,{state:{username:c}})},a=d=>{d.code=="Enter"&&u()};return e.jsxs("div",{className:"homePageWrapper",children:[e.jsxs("div",{className:"formWrapper",children:[e.jsxs("div",{children:[e.jsx("img",{src:"/code-sync.png",alt:"logo",className:"logo",style:{width:"10%"}}),e.jsx("span",{className:"heading",children:"CODE SYNC"})]}),e.jsx("h4",{className:"mainLabel",children:"Paste invitation Room Id"}),e.jsxs("div",{className:"inputGroup",children:[e.jsx("input",{type:"text",className:"inputBox",placeholder:"ROOM ID",value:t,onChange:d=>l(d.target.value),onKeyUp:a}),e.jsx("input",{type:"text",className:"inputBox",placeholder:"Username..",value:c,onChange:d=>r(d.target.value),onKeyUp:a}),e.jsx("button",{onClick:u,className:"btn joinBtn",children:"Join"}),e.jsxs("span",{className:"createInfo",children:["If you dont have an invite then create Â ",e.jsx("a",{onClick:n,href:"#",className:"createNewBtn",children:"new room"})]})]})]}),e.jsx("footer",{children:e.jsxs("h4",{children:["Built By ",e.jsx("a",{href:"#",children:"Sparsh Goel"})]})})]})},G=({username:o})=>e.jsxs("div",{className:"client",children:[e.jsx(b,{name:o,size:50,round:"14px"}),e.jsx("span",{className:"userName",children:o})]}),s={JOIN:"join",JOINED:"joined",DISCONNECTED:"disconnected",CODE_CHANGE:"code-change",SYNC_CODE:"sync-code",LEAVE:"leave",COMPILED_CODE:"compiled-code"},J=({socketRef:o,roomId:t,onCodeChange:l,compiledCode:c,compileCode:r})=>{const n=i.useRef(null),u=i.useRef(null);return i.useEffect(()=>{async function a(){n.current=R.fromTextArea(document.getElementById("realtimeEditor"),{mode:{name:"javascript",json:!0},theme:"dracula",autoCloseTags:!0,autoCloseBrackets:!0,lineNumbers:!0}),n.current.on("change",(d,x)=>{const{origin:E}=x,C=d.getValue();l(C),E!=="setValue"&&o.current.emit(s.CODE_CHANGE,{roomId:t,code:C})})}a()},[]),i.useEffect(()=>(o.current&&o.current.on(s.CODE_CHANGE,({code:a})=>{a!==null&&n.current.setValue(a)}),()=>{o.current.off(s.CODE_CHANGE)}),[o.current]),i.useEffect(()=>(o.current&&o.current.on(s.COMPILED_CODE,({output:a})=>{a!==null&&(u.current.innerHTML=a)}),()=>{o.current.off(s.COMPILED_CODE)}),[o.current]),e.jsxs("div",{children:[e.jsx("textarea",{className:"",name:"",id:"realtimeEditor",cols:"1",rows:"10"}),e.jsx("div",{className:"output",ref:u,children:c&&e.jsx("pre",{style:{fontFamily:"monospace",backgroundColor:"#f4f4f4",padding:"10px"},children:c})})]})},U=async()=>w("http://localhost:5000",{"force new connection":!0,reconnectionAttempt:"Infinity",timeout:1e4,transports:["websocket"]}),F=()=>{const o=i.useRef(null),t=i.useRef(null),{roomId:l}=L(),c=S(),r=O(),[n,u]=i.useState([]),[a,d]=i.useState("");i.useState(null);async function x(){try{const j=(await P.post("https://code-compiler.p.rapidapi.com/v2",{LanguageChoice:"17",Program:o.current},{headers:{"content-type":"application/x-www-form-urlencoded","x-rapidapi-host":"code-compiler.p.rapidapi.com","x-rapidapi-key":"eba0226bc6mshc006440642c4249p1de281jsnc5d4a2caa4e0"}})).data.Result;d(j),t.current.emit(s.COMPILED_CODE,{roomId:l,output:j})}catch(m){console.error(m),f.error("Code compilation failed")}}i.useEffect(()=>((async()=>{var y;t.current=await U(),t.current.on("connect_error",p=>j(p)),t.current.on("connect_failed",p=>j(p));function j(p){console.log("socket error",p),f.error("Socket connection failed, try again later."),r("/")}t.current.emit(s.JOIN,{roomId:l,username:(y=c.state)==null?void 0:y.username}),t.current.on(s.JOINED,({clients:p,username:h,socketId:g})=>{var N;h!==((N=c.state)==null?void 0:N.username)&&f.success(`${h} joined the room.`),u(p),t.current.emit(s.SYNC_CODE,{code:o.current,socketId:g})}),t.current.on(s.DISCONNECTED,({socketId:p,username:h})=>{f.success(`${h} left the room.`),u(g=>g.filter(N=>N.socketId!==p))}),t.current.on(s.COMPILED_CODE,({roomId:p,output:h})=>{console.log(p,h),d(h)})})(),()=>{t.current.disconnect(),t.current.off(s.JOINED),t.current.off(s.DISCONNECTED)}),[]);async function E(){try{await navigator.clipboard.writeText(l),f.success("Room ID has been copied to clipboard")}catch(m){f.error("Couldnt copy the Room ID"),console.log(m)}}const C=async()=>{try{await x(),t.current.emit(s.COMPILED_CODE,{roomId:l,output:a})}catch(m){console.error(m),f.error("Code compilation failed")}};function v(){r("/")}return c.state?e.jsxs("div",{className:"mainWrap",children:[e.jsxs("div",{className:"aside",children:[e.jsxs("div",{className:"asideInner",children:[e.jsxs("div",{className:"logo",children:[e.jsx("img",{src:"/code-sync.png",className:"logoImage",alt:"logo"}),e.jsx("span",{className:"head",children:"CODE SYNC"})]}),e.jsx("h3",{children:"Connected"}),e.jsx("div",{className:"clientsList",children:n.map(m=>e.jsx(G,{className:"client",username:m.username},m.socketId))})]}),e.jsx("button",{className:"btn",onClick:C,children:"Run"}),e.jsx("br",{}),e.jsx("button",{className:"btn copyBtn ",onClick:E,children:"Copy Room ID"}),e.jsx("button",{className:"btn leaveBtn",onClick:v,children:"Leave Room"})]}),e.jsx("div",{className:"editorwrap",children:e.jsx(J,{socketRef:t,roomId:l,onCodeChange:m=>{o.current=m},compiledCode:a,compileCode:C})})]}):e.jsx(_,{to:"/"})};function V(){return e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx(B,{position:"top-right",toastOptions:{success:{theme:{primary:"#e31313"}}}})}),e.jsxs(A,{children:[e.jsx(I,{path:"/",element:e.jsx(H,{})}),e.jsx(I,{path:"/editor/:roomId",element:e.jsx(F,{})})]})]})}M.createRoot(document.getElementById("root")).render(e.jsx(T,{children:e.jsx(V,{})}));
